# Алгоритм сортировки объемного файла

## Задача

### Условия

Дан файл размером 1ТБ, который содержит значения от 0 до 1000 в произвольном порядке с повторениями. Свободное место на файловой системе 1ТБ. Доступная свободная оперативная память 128МБ.

### Ожидаемый результат

Необходимо отсортировать значения в исходном файле и поместить в другой файл в отсортированном виде.

## Решение

### Алгоритм

1. Разделить исходный файл на множество временных файлов меньшего размера, значения из которых могут поместиться в оперативную память.
2. Выполнить сортировку в памяти для каждого временного файла и сохранить результат во временный файл.
3. Объединить значения отсортированных временных файлов в один файл, используя `heapq` из `Python`.
4. Полученный отсортированный файл будет содержать значения от 0 до 1000 в отсортированном порядке.

Занимаемая память для хрения и сортировки части файла ограничивается нами значением константы `MEMORY_SIZE_MB` в файле `sort_large_file.py`.

Конечная временная сложность алгоритма будет `O(N*log(N))`.

Т.к. 

1. Чтение исходного файла и запись каждого элемента в отдельные временные файлы это `O(N)`
2. Сортировка частей файла это `O(K * log K)`, где K количество элементов в каждой части
3. Чтение из временных файлов каждого элемента `O(N)` и выполнение действия добавления и получения из кучи это `log(N)`, то для операции слияния сложность `O(N*log(N))`.
4. Итоговая временная сложность `O(N*log(N))`.



### Тестировалось в окружении

- Windows 10 Home
- Python 3.10.5

### Запуск для тестирования

#### Предварительные шаги

Склонировать репозиторий или скачать и распокавать файлы из репозитория в отдельную директорию.

Создать виртуальное окружение в директории, используя Python 3.10.

Установка дополнительных зависимостей не требуется.

Производить запуск команд из директории с исполняемыми файлами и активированным виртуальным окружением.

#### Генерация демо файла с исходными данными

Открыть файл `gen_large_file.py`.

Изменить при необходимости значение константы `LINES`.

Сгенерировать демо файл с данными командой:

```
python gen_large_file.py
```

В директории с исполняемыми файлами появится файл `large_file.txt`.

#### Запуск сортировки

После генерации демо файла со значениями запустить сортировку командой:

```
python sort_large_file.py
```

Рядом с исполяемым файлом в директории появится файл `output_file.txt` с отсортированными значениями. 

Изменяя значение константы `MEMORY_SIZE_MB` можно регулировать размер в памяти данных для выполнения первоначальной сортировки и сохранения во временные файлы. 

### Что можно улучшить

- Добавить запуск через консоль с параметрами
- Расширить логирование выполнение алгоритма
- Добавить необходимую логику, в зависимости от требований, при обработке исключения